version: 3
workflows:
  custom-workflow:
    plan:
      steps:
        - run: bash ../tools/my_cicd_based_on_tke.sh init
        - run: bash ../tools/my_cicd_based_on_tke.sh plan
    apply:
      steps:
        - run: bash ../tools/my_cicd_based_on_tke.sh apply

projects:
  - name: cvm
    dir: cvm
    workspace: default
    workflow: custom-workflow
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true
  - name: clb
    dir: clb
    workspace: default
    workflow: custom-workflow
    autoplan:
      when_modified: ["*.tf", "*.tfvars"]
      enabled: true

